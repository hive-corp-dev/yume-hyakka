---
const isProd = import.meta.env.PROD;
---

<div class="ad-container">
{isProd ? (
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1076760418024606"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-1076760418024606"
data-ad-slot="5923658986"
data-full-width-responsive="true"
></ins>
<script is:inline>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
) : (
<script async data-adbreak-test="on" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1076760418024606" crossorigin="anonymous"></script>
<ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-1076760418024606"
data-ad-slot="5923658986"
data-full-width-responsive="true"
></ins>
<script is:inline>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
)}
</div>

<style>
.ad-container {
  width: 100%;
  max-width: 100%;
  overflow: hidden;
  margin: 2rem 0;
  display: flex;
  justify-content: center;
  box-sizing: border-box;
}

.ad-container .adsbygoogle {
  max-width: 100% !important;
  width: 100% !important;
  box-sizing: border-box !important;
}

/* AdSenseの強制的なサイズ指定を上書き */
.ad-container ins {
  max-width: 100% !important;
  width: 100% !important;
  box-sizing: border-box !important;
}

/* リサイズ時の対応 */
@media (max-width: 768px) {
  .ad-container {
    margin: 1.5rem 0;
  }
}
</style>

<style is:global>
/* グローバルなAdSense対応 */
.adsbygoogle {
  max-width: 100% !important;
  overflow: hidden !important;
  box-sizing: border-box !important;
}

/* リサイズ時の強制的な再調整 */
@media (max-width: 768px) {
  .adsbygoogle {
    width: 100% !important;
    max-width: 100% !important;
  }
}
</style>

<script is:inline>
// リサイズ時のAdSense調整
function resizeAds() {
  const ads = document.querySelectorAll('.adsbygoogle');
  ads.forEach(ad => {
    if (ad.style.width && parseInt(ad.style.width) > window.innerWidth) {
      ad.style.width = '100%';
      ad.style.maxWidth = '100%';
    }
  });
}

// 初期化とリサイズイベント
if (typeof window !== 'undefined') {
  window.addEventListener('resize', resizeAds);
  window.addEventListener('load', resizeAds);
  // MutationObserverでAdSenseの動的変更を監視
  const observer = new MutationObserver(resizeAds);
  observer.observe(document.body, {
    childList: true,
    subtree: true,
    attributes: true,
    attributeFilter: ['style']
  });
}
</script>


